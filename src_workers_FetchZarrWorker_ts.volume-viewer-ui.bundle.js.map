{"version":3,"file":"src_workers_FetchZarrWorker_ts.volume-viewer-ui.bundle.js","mappings":"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,OAAO,CAAClC,KAAK,CAAC;UAChDmC,OAAO,GAAG;YAAEM,IAAI,EAAExC,EAAE;YAAEiC,OAAO,EAAEd,YAAY,KAAK,CAAC,CAAC,GAAG,CAAC,GAAGA;UAAa,CAAC;UAC5ET,IAAI,CAAuBuC,WAAW,CAACf,OAAO,EAAE,CAACA,OAAO,CAACM,IAAI,CAACU,MAAM,CAAC,CAAC;QAAC;QAAA;UAAA,OAAAb,QAAA,CAAAc,IAAA;MAAA;IAAA,GAAAnC,OAAA;EAAA,CACzE;EAAA,iBAAAoC,EAAA;IAAA,OAAAxC,IAAA,CAAAyC,KAAA,OAAAC,SAAA;EAAA;AAAA;;;;;;UC/DD;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;;;;WClCA;WACA;WACA;WACA;WACA,+BAA+B,wCAAwC;WACvE;WACA;WACA;WACA;WACA,iBAAiB,qBAAqB;WACtC;WACA;WACA,kBAAkB,qBAAqB;WACvC;WACA;WACA,KAAK;WACL;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WC3BA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,EAAE;WACF;;;;;WCRA;WACA;WACA;WACA;WACA;;;;;WCJA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC;;;;;WCPD;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;WCNA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WClBA;;WAEA;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,aAAa;WACb;WACA;WACA;WACA;;WAEA;WACA;WACA;;WAEA;;WAEA;;;;;WCpCA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;UENA;UACA","sources":["webpack://@aics/volume-viewer/./src/workers/FetchZarrWorker.ts","webpack://@aics/volume-viewer/webpack/bootstrap","webpack://@aics/volume-viewer/webpack/runtime/chunk loaded","webpack://@aics/volume-viewer/webpack/runtime/compat get default export","webpack://@aics/volume-viewer/webpack/runtime/define property getters","webpack://@aics/volume-viewer/webpack/runtime/ensure chunk","webpack://@aics/volume-viewer/webpack/runtime/get javascript chunk filename","webpack://@aics/volume-viewer/webpack/runtime/global","webpack://@aics/volume-viewer/webpack/runtime/hasOwnProperty shorthand","webpack://@aics/volume-viewer/webpack/runtime/make namespace object","webpack://@aics/volume-viewer/webpack/runtime/publicPath","webpack://@aics/volume-viewer/webpack/runtime/importScripts chunk loading","webpack://@aics/volume-viewer/webpack/runtime/startup chunk dependencies","webpack://@aics/volume-viewer/webpack/before-startup","webpack://@aics/volume-viewer/webpack/startup","webpack://@aics/volume-viewer/webpack/after-startup"],"sourcesContent":["import { HTTPStore, openArray, slice, TypedArray } from \"zarr\";\nimport { RawArray } from \"zarr/types/rawArray\";\nimport { Slice } from \"zarr/types/core/types\";\n\nimport { LoadSpec } from \"../loaders/IVolumeLoader\";\n\nexport type FetchZarrMessage = {\n  spec: Required<LoadSpec>;\n  channel: number;\n  path: string;\n  axesTCZYX: number[];\n};\n\nfunction convertChannel(channelData: TypedArray, dtype: string): Uint8Array {\n  if (dtype === \"|u1\") {\n    return channelData as Uint8Array;\n  }\n\n  const u8 = new Uint8Array(channelData.length);\n\n  // get min and max\n  let min = channelData[0];\n  let max = channelData[0];\n  channelData.forEach((val: number) => {\n    min = Math.min(min, val);\n    max = Math.max(max, val);\n  });\n\n  // normalize and convert to u8\n  const range = max - min;\n  channelData.forEach((val: number, idx: number) => {\n    u8[idx] = ((val - min) / range) * 255;\n  });\n\n  return u8;\n}\n\nself.onmessage = async (e: MessageEvent<FetchZarrMessage>) => {\n  const time = e.data.spec.time;\n  const channelIndex = e.data.channel;\n  const axesTCZYX = e.data.axesTCZYX;\n\n  const store = new HTTPStore(e.data.spec.url);\n  const level = await openArray({ store: store, path: e.data.path, mode: \"r\" });\n\n  // build slice spec\n  const { minx, maxx, miny, maxy, minz, maxz } = e.data.spec;\n  const unorderedSpec = [time, channelIndex, slice(minz, maxz), slice(miny, maxy), slice(minx, maxx)];\n\n  const specLen = 3 + Number(axesTCZYX[0] > -1) + Number(axesTCZYX[1] > -1);\n  const sliceSpec: (number | Slice)[] = Array(specLen);\n\n  axesTCZYX.forEach((val, idx) => {\n    if (val > -1) {\n      sliceSpec[val] = unorderedSpec[idx];\n    }\n  });\n\n  const channel = (await level.getRaw(sliceSpec)) as RawArray;\n\n  const u8 = convertChannel(channel.data, channel.dtype);\n  const results = { data: u8, channel: channelIndex === -1 ? 0 : channelIndex };\n  (self as unknown as Worker).postMessage(results, [results.data.buffer]);\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [\"vendors-node_modules_babel_runtime_regenerator_index_js-node_modules_babel_runtime_helpers_es-58772e\",\"vendors-node_modules_zarr_zarr_mjs\"], () => (__webpack_require__(\"./src/workers/FetchZarrWorker.ts\")))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".volume-viewer-ui.bundle.js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t\"src_workers_FetchZarrWorker_ts\": 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunk_aics_volume_viewer\"] = self[\"webpackChunk_aics_volume_viewer\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([\n\t\t__webpack_require__.e(\"vendors-node_modules_babel_runtime_regenerator_index_js-node_modules_babel_runtime_helpers_es-58772e\"),\n\t\t__webpack_require__.e(\"vendors-node_modules_zarr_zarr_mjs\")\n\t]).then(next);\n};","","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n",""],"names":["HTTPStore","openArray","slice","convertChannel","channelData","dtype","u8","Uint8Array","length","min","max","forEach","val","Math","range","idx","self","onmessage","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","time","channelIndex","axesTCZYX","store","level","_e$data$spec","minx","maxx","miny","maxy","minz","maxz","unorderedSpec","specLen","sliceSpec","channel","results","wrap","_callee$","_context","prev","next","data","spec","url","path","mode","sent","Number","Array","getRaw","postMessage","buffer","stop","_x","apply","arguments"],"sourceRoot":""}